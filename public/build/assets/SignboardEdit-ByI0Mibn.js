import{d as U,x as h,r as u,y as k,f as w,c as R,o as S,a as n,u as m,g as L,w as O,b as I,F as E}from"./app-CXS1pmq2.js";import{t as F,a as j}from"./helpers-CBGJZMR4.js";import{_ as G}from"./Layout.vue_vue_type_script_setup_true_lang-J6eF2hI-.js";import{_ as P}from"./SignboardForm.vue_vue_type_script_setup_true_lang-QDBegQoj.js";import{_ as x}from"./PageHeader.vue_vue_type_script_setup_true_lang-j8kyFWr5.js";import{P as B}from"./pen-line-DxifUR0S.js";import"./InputText.vue_vue_type_script_setup_true_lang-CAt1LYsT.js";import"./x-zPdTgu-7.js";import"./map-pin-hREdaShW.js";import"./ImageUpload.vue_vue_type_script_setup_true_lang-8nwWIqva.js";import"./upload-BNNoctRb.js";import"./GalleryUpload.vue_vue_type_script_setup_true_lang-B8nQfMBD.js";import"./plus-C2Ynrhkg.js";import"./check-NnJEYmJG.js";const W={class:"w-full bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50"},X=U({__name:"SignboardEdit",props:{signboard:{},categories:{},regions:{},businesses:{}},setup(d){const l=d,r=h({business_id:"",region_id:"",categories:[],town:"",street:"",landmark:"",blk_number:"",gps:"",featured_image:null,gallery_images:[],removed_gallery_urls:[]}),t=u(l.signboard.featured_url||null),g=u([...l.signboard.gallery_urls||[]]),i=u([]),c=k(()=>Object.keys(r.errors).filter(e=>e.startsWith("gallery_images.")).map(e=>r.errors[e]));w(()=>{var e;r.business_id=String(l.signboard.business_id),r.region_id=String(l.signboard.region_id),r.categories=((e=l.signboard.categories)==null?void 0:e.map(s=>s.id))||[],r.town=l.signboard.town||"",r.street=l.signboard.street||"",r.landmark=l.signboard.landmark||"",r.blk_number=l.signboard.blk_number||"",r.gps=l.signboard.gps||"",i.value=(l.signboard.gallery_urls||[]).map((s,a)=>({url:s,isOriginal:!0,originalIndex:a}))});const b=()=>{r.post(route("my-signboards.update",l.signboard.id),{forceFormData:!0,onSuccess:e=>{const s=e.props.message;e.props.success?(F(s),r.removed_gallery_urls=[]):j(s)},preserveScroll:!0})},p=e=>{var a;const s=((a=e.target.files)==null?void 0:a[0])||null;r.featured_image=s,t.value&&t.value.startsWith("blob:")&&URL.revokeObjectURL(t.value),t.value=s?URL.createObjectURL(s):null},f=()=>{r.featured_image=null,t.value&&t.value.startsWith("blob:")&&URL.revokeObjectURL(t.value),t.value=null},v=e=>{(e.target.files?Array.from(e.target.files):[]).forEach(a=>{const o=URL.createObjectURL(a);r.gallery_images.push(a),i.value.push({url:o,isOriginal:!1})}),g.value=i.value.map(a=>a.url),e.target.value=""},_=e=>{const s=i.value[e];if(s.isOriginal)r.removed_gallery_urls.push(s.url);else{const a=s.url;URL.revokeObjectURL(a);const o=i.value.slice(0,e).filter(y=>!y.isOriginal).length;o<r.gallery_images.length&&r.gallery_images.splice(o,1)}i.value.splice(e,1),g.value=i.value.map(a=>a.url)};return(e,s)=>(S(),R(E,null,[n(m(L),{title:"Edit Signboard"}),n(G,null,{default:O(()=>[I("div",W,[n(x,{title:"Edit Signboard",subtitle:"Update your signboard listing information",icon:m(B)},null,8,["icon"]),n(P,{form:m(r),categories:e.categories,regions:e.regions,businesses:e.businesses,"business-field-disabled":!0,"featured-preview":t.value,"gallery-previews":g.value,"gallery-items":i.value,"gallery-errors":c.value,"submit-text":"Update Signboard","processing-text":"Updating Signboard...",onHandleFeaturedImage:p,onRemoveFeatured:f,onHandleGalleryImages:v,onRemoveGalleryImage:_,onSubmit:b},null,8,["form","categories","regions","businesses","featured-preview","gallery-previews","gallery-items","gallery-errors"])])]),_:1})],64))}});export{X as default};
