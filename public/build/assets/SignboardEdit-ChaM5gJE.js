import{d as U,x as h,r as u,y as k,f as w,c as R,o as S,a as n,u as m,g as L,w as O,b as I,F as E}from"./app-BOPBDEOJ.js";import{t as F,a as j}from"./helpers-CFBl1wBm.js";import{_ as G}from"./Layout.vue_vue_type_script_setup_true_lang-CtcU11eY.js";import{_ as P}from"./SignboardForm.vue_vue_type_script_setup_true_lang-CEFntyuc.js";import{_ as x}from"./PageHeader.vue_vue_type_script_setup_true_lang-aU6bFS8g.js";import{P as B}from"./pen-line-DJLNbrRy.js";import"./index-BM97N_Nr.js";import"./Input.vue_vue_type_script_setup_true_lang-CwfZm3pO.js";import"./createLucideIcon-BaIeN4gu.js";import"./useForwardPropsEmits-CoI_qNUh.js";import"./chevron-down-f1ySP0SZ.js";import"./DialogPortal-C-LhXReZ.js";import"./x-Dj2TzlDo.js";import"./InputText.vue_vue_type_script_setup_true_lang-C_Rp8yhY.js";import"./Label.vue_vue_type_script_setup_true_lang-5-aXTjMV.js";import"./map-pin-BjXMxC_o.js";import"./building-2-B5BVVrvd.js";import"./InputSelect.vue_vue_type_script_setup_true_lang-BfTxdV7X.js";import"./ImageUpload.vue_vue_type_script_setup_true_lang-GfkmypZ0.js";import"./upload-OgBPSB9o.js";import"./GalleryUpload.vue_vue_type_script_setup_true_lang-BBo_SMrs.js";import"./plus-BJkrZeQR.js";import"./check-DRoB-Pri.js";const W={class:"w-full bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50"},le=U({__name:"SignboardEdit",props:{signboard:{},categories:{},regions:{},businesses:{}},setup(d){const t=d,r=h({business_id:"",region_id:"",categories:[],town:"",street:"",landmark:"",blk_number:"",gps:"",featured_image:null,gallery_images:[],removed_gallery_urls:[]}),i=u(t.signboard.featured_url||null),g=u([...t.signboard.gallery_urls||[]]),l=u([]),c=k(()=>Object.keys(r.errors).filter(e=>e.startsWith("gallery_images.")).map(e=>r.errors[e]));w(()=>{var e;r.business_id=String(t.signboard.business_id),r.region_id=String(t.signboard.region_id),r.categories=((e=t.signboard.categories)==null?void 0:e.map(s=>s.id))||[],r.town=t.signboard.town||"",r.street=t.signboard.street||"",r.landmark=t.signboard.landmark||"",r.blk_number=t.signboard.blk_number||"",r.gps=t.signboard.gps||"",l.value=(t.signboard.gallery_urls||[]).map((s,a)=>({url:s,isOriginal:!0,originalIndex:a}))});const p=()=>{r.post(route("my-signboards.update",t.signboard.id),{forceFormData:!0,onSuccess:e=>{const s=e.props.message;e.props.success?(F(s),r.removed_gallery_urls=[]):j(s)},preserveScroll:!0})},b=e=>{var a;const s=((a=e.target.files)==null?void 0:a[0])||null;r.featured_image=s,i.value&&i.value.startsWith("blob:")&&URL.revokeObjectURL(i.value),i.value=s?URL.createObjectURL(s):null},f=()=>{r.featured_image=null,i.value&&i.value.startsWith("blob:")&&URL.revokeObjectURL(i.value),i.value=null},v=e=>{(e.target.files?Array.from(e.target.files):[]).forEach(a=>{const o=URL.createObjectURL(a);r.gallery_images.push(a),l.value.push({url:o,isOriginal:!1})}),g.value=l.value.map(a=>a.url),e.target.value=""},_=e=>{const s=l.value[e];if(s.isOriginal)r.removed_gallery_urls.push(s.url);else{const a=s.url;URL.revokeObjectURL(a);const o=l.value.slice(0,e).filter(y=>!y.isOriginal).length;o<r.gallery_images.length&&r.gallery_images.splice(o,1)}l.value.splice(e,1),g.value=l.value.map(a=>a.url)};return(e,s)=>(S(),R(E,null,[n(m(L),{title:"Edit Signboard"}),n(G,null,{default:O(()=>[I("div",W,[n(x,{title:"Edit Signboard",subtitle:"Update your signboard listing information",icon:m(B)},null,8,["icon"]),n(P,{form:m(r),categories:e.categories,regions:e.regions,businesses:e.businesses,"business-field-disabled":!0,"featured-preview":i.value,"gallery-previews":g.value,"gallery-items":l.value,"gallery-errors":c.value,"submit-text":"Update Signboard","processing-text":"Updating Signboard...",onHandleFeaturedImage:b,onRemoveFeatured:f,onHandleGalleryImages:v,onRemoveGalleryImage:_,onSubmit:p},null,8,["form","categories","regions","businesses","featured-preview","gallery-previews","gallery-items","gallery-errors"])])]),_:1})],64))}});export{le as default};
